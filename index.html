<!DOCTYPE html>
<html>
    <head>
        <title>BasketBall Game</title>
        <style>
        #canvi {
            margin-left: -10px;
            margin-top: -10px;
        }
        </style>
    </head>
    <body>
    <canvas id="canvi"></canvas>
    
    <script>
        // makes it more like javascript
        var canvas = document.getElementById("canvi");
        var ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        var mouseX = 0;
        var mouseY = 0;
        var clicked = false
        var keys = [];
        function fill(r, g, b) {
            ctx.fillStyle = "rgb(" + r + ", " + g + ", " + b + ")";
        }
        function stroke(r, g, b) {
            ctx.strokeStyle = "rgb(" + r + ", " + g + ", " + b + ")";
        }
        function rect(x, y, w, h) {
            ctx.fillRect(x, y, w, h)
        }
        function strokeWeight(s) {
            ctx.lineWidth = s;
        }
        function eRect(x, y, w, h, col) {
            ctx.beginPath();
            stroke(col[0], col[1], col[2])
            ctx.rect(x, y, w, h);
            ctx.stroke()
        }
        function start() {
            myVar = setInterval(draw, 1);
        }
        function text(txt, x, y, size) {
            ctx.font = size + "px Arial";
            ctx.fillText(txt, x, y);
        }
        function textAlign(align) {
            ctx.textAlign = align
        }
        function lerp(a, b, t) {
            return a + (b - a) * t;
        }
        function dist2(a, b, d) {
            return (a - b) > -d && (a - b) < d
        }
        function ellipse(x, y, radiusX, radiusY, rotation, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.ellipse(x, y, radiusX, radiusY, rotation, 0, 2 * Math.PI);
            ctx.fill();
        }
        canvas.addEventListener("mousemove", function(e) { 
            var cRect = canvas.getBoundingClientRect();
            mouseX = Math.round(e.clientX - cRect.left);
            mouseY = Math.round(e.clientY - cRect.top);
        });
        canvas.addEventListener("mousedown", function(e) {
            clicked = true
        }, false);
        window.addEventListener('keydown', function(e) {
            if(scene === "play") {
                if(e.keyCode === 68 || e.keyCode === 39) {
                    players[0][0]+=4
                } else if(e.keyCode === 65 || e.keyCode === 37) {
                    players[0][0]-=4
                }
            }
        }, false);
        window.addEventListener("keydown", keysPressed, false);
        window.addEventListener("keyup", keysReleased, false);
        function keysPressed(e) {
            // store an entry for every key pressed
            keys[e.keyCode] = true;
         
            e.preventDefault();
        }
         
        function keysReleased(e) {
            // mark keys that were released
            keys[e.keyCode] = false;
        }
        // game
        var menu = {
            BBy: -20,
            Bx: -200,
            B2x: canvas.width + 10,
            B3x: -200,
        }
        var score = [0, 0]
        var scene = "menu"
        var players = []
        var ballX = canvas.width/2
        var ballY = canvas.height - 80
        var ballGrav = 0;
        var ballMom = 0;
        function floor(num) {
            return Math.floor(num)
        }
        function button(x, y, w, h, t, txt) {
            strokeWeight(3)
            eRect(x, y, w, h, (0, 0, 0))
            textAlign("center")
            text(txt[0], x + w/2, y + h/2 + txt[1]/4, txt[1])
            if(mouseX > x && mouseY > y && mouseX < x + w && mouseY < y + h && clicked) {
                t();
            }
        }
        
        function drawMenu() {
            fill(194, 103, 0);
            rect(0, 0, canvas.width, canvas.height);
            fill(0, 0, 0);
            textAlign("center");
            text("BasketBall", canvas.width/2, menu.BBy, 50);
            button(menu.Bx, 100, 100, 50, function() {
                    scene = "play"
                    menu = {
                        BBy: -20,
                        Bx: -200,
                        B2x: canvas.width + 10,
                        B3x: -200,
                    }
                    players = []
                    for(var i = 0; i < 5; i+=1) {
                        players.push([35 + i * 20, canvas.height - 80, 0])
                    }
                    for(var i = 0; i < 5; i+=1) {
                        players.push([canvas.width - (50 + i * 20), canvas.height - 80, 0])
                    }
            }, ["Play", 30])
            button(menu.B2x, 175, 100, 50, function() {
                    scene = "how"
                    menu = {
                        BBy: -20,
                        Bx: -200,
                        B2x: canvas.width + 10,
                        B3x: -200,
                    }
            }, ["How", 30])
            button(menu.B3x, 250, 100, 50, function() {
                    scene = "credits"
                    menu = {
                        BBy: -20,
                        Bx: -200,
                        B2x: canvas.width + 10,
                        B3x: -200,
                    }
            }, ["Credits", 30])
        }
        function updateMenu() {
            if(menu.BBy <= 49) {
                menu.BBy = lerp(menu.BBy, 50, 0.01);
            }
            if(menu.BBy > 45) {
                menu.Bx = lerp(menu.Bx, canvas.width/2 - 50, 0.01);
            }
            if(dist2(menu.Bx, canvas.width/2 - 50, 5)){
                menu.B2x = lerp(menu.B2x, canvas.width/2 - 50, 0.01);
            }
            if(dist2(menu.B2x, canvas.width/2 - 50, 5)){
                menu.B3x = lerp(menu.B3x, canvas.width/2 - 50, 0.01);
            }
        }
        
        function drawPlay() {
            fill(194, 103, 0);
            rect(0, 0, canvas.width, canvas.height);
            textAlign("center")
            fill(0, 0, 0)
            text(score[0] + "/" + score[1], canvas.width/2, 40, 40)
            fill(143, 76, 1)
            rect(0, canvas.height - 50, canvas.width, 50)
            fill(235, 124, 0)
            ellipse(ballX, ballY, 10, 10, 0, 'brown');
            fill(100, 100, 100)
            rect(10, canvas.height - 150, 10, 100)
            rect(canvas.width - 20, canvas.height - 150, 10, 100)
            fill(255, 255, 255)
            rect(10, canvas.height - 175, 10, 25)
            rect(canvas.width - 20, canvas.height - 175, 10, 25)
            if(ballY < canvas.height - 60) {
                ballGrav+=0.01;
            } else {
                ballGrav *= -0.3;
                ballY = canvas.height - 60
            }
            ballY+=ballGrav;
            ballX+=ballMom;
            for(var i = 0; i < players.length; i+=1) {
                fill(252, 190, 121)
                ellipse(players[i][0] + 7, players[i][1] - 10, 7.5, 7.5, 0, (252, 190, 121));
                if(i < 5) {
                    fill(0, 0, 255)
                } else {
                    fill(255, 0, 0)
                }
                if(i === 0) {
                    fill(0, 100, 255)
                    // left
                    if (keys[65] || keys[37]) {
                        players[i][0] -= 1;
                    }
                 
                    // right
                    if (keys[68] || keys[39]) {
                        players[i][0] += 1;
                    }
                    
                    // up
                    if (keys[87]  && players[i][1] >= canvas.height - 70 || keys[38] && players[i][1] >= canvas.height - 70) {
                        players[i][2] = -3;
                    }
                } else {
                    if(players[i][0] > 10 + i * 30 + (floor(i/5) * (canvas.width - 160))) {
                        players[i][0]-=1
                    } else if(players[i][0] < 10 + i * 30 + (floor(i/5) * (canvas.width - 160))) {
                        players[i][0]+=1
                    } 
                }
                players[i][1]+=players[i][2]
                if(players[i][1] < canvas.height - 70) {
                    players[i][2]+=0.05
                } else {
                    players[i][1] = canvas.height - 70
                    players[i][2] *= 0.3
                }
                for(var j = 0; j < players.length; j+=1) {
                    if(players[j][0] >= players[i][0] && players[j][0] < players[i][0] + 15 && players[j][1] >= players[i][1] && players[j][1] < players[i][1] + 20 && i !== j) {
                        if(players[i][0] < players[j][0]){
                            players[i][0]-=(7.5 - (players[i][0] + 7.5 - (players[j][0] + 7.5)))/8
                            players[j][0]-=(7.5 - (players[j][0] + 7.5 - (players[i][0] + 7.5)))/8
                        } else {
                            players[i][0]+=(7.5 - (players[i][0] + 7.5 - (players[j][0] + 7.5)))/8
                            players[j][0]+=(7.5 - (players[j][0] + 7.5 - (players[i][0] + 7.5)))/8
                        }
                    }
                }
                rect(players[i][0], players[i][1], 15, 20)
            }
        }
        
        function drawHow() {
            fill(194, 103, 0);
            rect(0, 0, canvas.width, canvas.height);
            fill(0, 0, 0)
            button(canvas.width/2 - 50, canvas.height - 100, 100, 50, function() {
                    scene = "menu"
            }, ["Back", 30])
        }
        
        function drawCredits() {
            fill(194, 103, 0);
            rect(0, 0, canvas.width, canvas.height);
            fill(0, 0, 0)
            button(canvas.width/2 - 50, canvas.height - 100, 100, 50, function() {
                    scene = "menu"
            }, ["Back", 30])
        }
        function draw() { 
            switch(scene) {
                case "menu":
                    drawMenu();
                    updateMenu()
                break;
                case "play":
                    drawPlay();
                break;
                case "how":
                    drawHow()
                break;
                case "credits":
                    drawCredits()
                break;
            }
            clicked = false;
        }
        draw()
        start()
        
    </script>
    
    </body>
</html>
